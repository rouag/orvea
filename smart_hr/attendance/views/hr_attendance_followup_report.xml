<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <template id="hr_attendance_followup_report">
            <t t-call="report.html_container">
                <t t-set="wizard" t-value="data['form']"/>
                <t t-call="smart_hr.external_layout_hr">
                    <div class="page" style="direction:rtl;">
                        <t t-foreach="get_employees(wizard)" t-as="employee">
                            <p align="left">تاريخ الطباعة: <span t-esc="today"/></p>
                            <h1 align="center">تقرير المتابعة</h1>
                            <h1 align="center">غياب الموظف فى الفترة ما بين: <span t-esc="get_ummqura(wizard['date_from'])[3]"/> الى <span t-esc="get_ummqura(wizard['date_to'])[3]"/></h1>
                            <hr/>
                            <table class="table table-striped table-bordered">
                                <tr>
                                    <td>الموظف</td>
                                    <td align="center"><span t-esc="employee.name or ''"/></td>
                                    <td>رقم</td>
                                    <td align="center"><span t-esc="employee.number or ''"/></td>
                                    <td>الإدارة</td>
                                    <td align="center"><span t-esc="employee.department_id.name or ''"/></td>
                                </tr>
                                <tr>
                                    <td>الوظيفة</td>
                                    <td align="center"><span t-esc="employee.job_id.name or ''"/></td>
                                    <td>المرتبة</td>
                                    <td align="center"><span t-esc="employee.job_id.salary_ladder_id.salary_ladder_level_id.name or ''"/></td>
                                    <td>الدرجة</td>
                                    <td align="center"><span t-esc="employee.job_id.salary_ladder_id.name or ''"/></td>
                                </tr>
                            </table>
                            <table class="table table-striped table-bordered">
                                <tr>
                                    <th style="text-align:center !important;">يوم</th>
                                    <th style="text-align:center !important;">تاريخ الغياب</th>
                                    <th style="text-align:center !important;">نوعه</th>
                                    <th style="text-align:center !important;">دقائق</th>
                                    <th style="text-align:center !important;">ساعات</th>
                                    <th style="text-align:center !important;">ايام</th>
                                </tr>
                                <t t-set="total_minutes" t-value="0"/>
                                <t t-set="total_hours" t-value="0"/>
                                <t t-set="total_days" t-value="0"/>
                                <t t-foreach="get_followup(employee.id, wizard['date_from'], wizard['date_to'], wizard)" t-as="rec">
                                    <tr>
                                        <td align="center"><span t-esc="rec['day']"/></td>
                                        <td align="center"><span t-esc="rec['date']"/></td>
                                        <td align="center"><span t-esc="rec['description']"/></td>
                                        <td align="center"><span t-esc="rec['minutes']"/></td>
                                        <td align="center"><span t-esc="rec['hours']"/></td>
                                        <td align="center"><span t-esc="rec['days']"/></td>
                                        <t t-set="total_minutes" t-value="total_minutes + rec['minutes']"/>
                                        <t t-set="total_hours" t-value="total_hours + rec['hours']"/>
                                        <t t-set="total_days" t-value="total_days + rec['days']"/>
                                    </tr>
                                </t>
                                <t t-set="total_time" t-value="get_total_time(total_minutes, total_hours, total_days)"/>
                                <tr>
                                    <td align="center"> - </td>
                                    <td align="center"> - </td>
                                    <td align="center">المجموع</td>
                                    <td align="center"><span t-esc="total_time[1]"/></td>
                                    <td align="center"><span t-esc="total_time[2]"/></td>
                                    <td align="center"><span t-esc="total_time[3]"/></td>
                                </tr>
                            </table>
                        </t>
                    </div>
                </t>
            </t>
        </template>

    </data>
</openerp>